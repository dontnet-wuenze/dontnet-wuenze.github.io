"use strict";(self.webpackChunkboss_wiki=self.webpackChunkboss_wiki||[]).push([[1883],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var o=a.createContext({}),c=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(o.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=c(n),h=l,f=u["".concat(o,".").concat(h)]||u[h]||p[h]||r;return n?a.createElement(f,i(i({ref:t},d),{},{components:n})):a.createElement(f,i({ref:t},d))}));function h(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,i=new Array(r);i[0]=u;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:l,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},2821:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(7462),l=(n(7294),n(3905));const r={},i=void 0,s={unversionedId:"tech/c++/\u5934\u6587\u4ef6 Include \u89c4\u8303",id:"tech/c++/\u5934\u6587\u4ef6 Include \u89c4\u8303",title:"\u5934\u6587\u4ef6 Include \u89c4\u8303",description:"https://www.eventhelix.com/design-patterns/header-file-include/",source:"@site/docs/tech/c++/\u5934\u6587\u4ef6 Include \u89c4\u8303.md",sourceDirName:"tech/c++",slug:"/tech/c++/\u5934\u6587\u4ef6 Include \u89c4\u8303",permalink:"/docs/tech/c++/\u5934\u6587\u4ef6 Include \u89c4\u8303",draft:!1,editUrl:"https://github.com/dontnet-wuenze/Wiki_Docusaurus/edit/master/docs/tech/c++/\u5934\u6587\u4ef6 Include \u89c4\u8303.md",tags:[],version:"current",frontMatter:{},sidebar:"techSidebar",previous:{title:"\u51fd\u6570\u6307\u9488\u7c7b\u578b",permalink:"/docs/tech/c++/\u51fd\u6570\u6307\u9488\u7c7b\u578b"},next:{title:"\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u4e0e\u8d4b\u503c\u51fd\u6570\u533a\u522b",permalink:"/docs/tech/c++/\u62f7\u8d1d\u6784\u9020\u51fd\u6570\u4e0e\u8d4b\u503c\u51fd\u6570\u533a\u522b"}},o={},c=[{value:"Header File Inclusion Rules",id:"header-file-inclusion-rules",level:2},{value:"Header File Inclusion Example",id:"header-file-inclusion-example",level:2},{value:"File Inclusion Analysis",id:"file-inclusion-analysis",level:2},{value:"Key Points",id:"key-points",level:2},{value:"Cyclic Dependency",id:"cyclic-dependency",level:2}],d={toc:c};function p(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://www.eventhelix.com/design-patterns/header-file-include/"},"https://www.eventhelix.com/design-patterns/header-file-include/")),(0,l.kt)("h1",{id:"c-header-file-include-patterns"},"C++ Header File Include Patterns"),(0,l.kt)("p",null,"Large software projects require a careful header file management even when programming in C. When developers move to C++, header file management becomes even more complex and time consuming. Here we present a few header file inclusion patterns that will simplify this chore."),(0,l.kt)("h2",{id:"header-file-inclusion-rules"},"Header File Inclusion Rules"),(0,l.kt)("p",null,"Here, we discuss the basic rules of C++ header file inclusion needed to simplify header file management."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"A header file should be included only when a forward declaration would not do the job."),(0,l.kt)("li",{parentName:"ul"},"The header file should be so designed that the order of header file inclusion is not important. ",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"This is achieved by making sure that x.h is the first header file in x.cpp"))),(0,l.kt)("li",{parentName:"ul"},"The header file inclusion mechanism should be tolerant to duplicate header file inclusions.\nThe following sections will explain these rules with the help of an example.")),(0,l.kt)("h2",{id:"header-file-inclusion-example"},"Header File Inclusion Example"),(0,l.kt)("p",null,"The following example illustrates different types of dependencies. Assume a class A with code stored in a.cpp and a.h."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"a.h")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},'#ifndef _a_h_included_\n#define _a_h_included_\n#include "abase.h"\n#include "b.h"\n\n// Forward Declarations\nclass C;\nclass D;\n\nclass A : public ABase\n{\n  B m_b;\n  C *m_c;\n  D *m_d;\n  \npublic:\n  void SetC(C *c);\n  C *GetC() const;\n  \n  void ModifyD(D *d);\n};\n#endif\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"a.cpp")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},'#include "a.h"\n#include "d.h"\n\nvoid A::SetC(C* c)\n{\n  m_c = c;\n}\n\nC* A::GetC() const\n{\n  return m_c;\n}\n\nvoid A::ModifyD(D* d)\n{\n  d->SetX(0);\n  d->SetY(0);\n  m_d = d;\n}\n')),(0,l.kt)("h2",{id:"file-inclusion-analysis"},"File Inclusion Analysis"),(0,l.kt)("p",null,"Lets analyze the header file inclusions, from the point of view of classes involved in this example, i.e. ABase, A, B, C and D."),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:"left"}),(0,l.kt)("th",{parentName:"tr",align:"left"}))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"Class ABase"),(0,l.kt)("td",{parentName:"tr",align:"left"},"ABase is the base class, so the class declaration is required to complete the class declaration. The compiler needs to know the size of ABase to determine the total size of A. In this case ",(0,l.kt)("strong",{parentName:"td"},"abase.h")," should be included explicitly in ",(0,l.kt)("strong",{parentName:"td"},"a.h"),".")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"Class B"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Class A contains Class B by value , so the class declaration is required to complete the class declaration. The compiler needs to know the size of B to determine the total size of A. In this case ",(0,l.kt)("strong",{parentName:"td"},"b.h")," should be included explicitly in ",(0,l.kt)("strong",{parentName:"td"},"a.h"),".")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"Class C"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Class C is included only as a pointer reference. The size or actual content of C are not important to ",(0,l.kt)("strong",{parentName:"td"},"a.h")," or ",(0,l.kt)("strong",{parentName:"td"},"a.cpp"),". Thus only a forward declaration has been included in ",(0,l.kt)("strong",{parentName:"td"},"a.h"),". Notice that c.h has not been included in either ",(0,l.kt)("strong",{parentName:"td"},"a.h")," or ",(0,l.kt)("strong",{parentName:"td"},"a.cpp"),".")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:"left"},"Class D"),(0,l.kt)("td",{parentName:"tr",align:"left"},"Class D is just used as a pointer reference in ",(0,l.kt)("strong",{parentName:"td"},"a.h"),". Thus a forward declaration is sufficient. But ",(0,l.kt)("strong",{parentName:"td"},"a.cpp")," uses class D in substance so it explicitly includes ",(0,l.kt)("strong",{parentName:"td"},"d.h"),".")))),(0,l.kt)("h2",{id:"key-points"},"Key Points"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Header files should be included only when a forward declaration will not do the job. By not including c.h and d.h other clients of class A never have to worry about c.h and d.h unless they use class C and D by value."),(0,l.kt)("li",{parentName:"ul"},"a.h has been included as the first header file in a.cpp This will make sure that a.h does not expect a certain header files to be included before a.h. As a.h has been included as the first file, successful compilation of a.cpp will ensure that a.h does not expect any other header file to be included before a.h.",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"If this is followed for all classes, (i.e. x.cpp always includes x.h as the first header) there will be no dependency on header file inclusion."))),(0,l.kt)("li",{parentName:"ul"},"a.h includes the check on preprocessor definition of symbol ","_","a",(0,l.kt)("em",{parentName:"li"},"h_included"),". This makes it tolerant to duplicate inclusions of a.h.")),(0,l.kt)("h2",{id:"cyclic-dependency"},"Cyclic Dependency"),(0,l.kt)("p",null,"Cyclic dependency exists between class X and Y in the following example. This dependency is handled by using forward declarations."),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"x.h and y.h")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-cpp"},"/* ====== x.h ====== */\n// Forward declaration of Y for cyclic dependency\nclass Y;\n\nclass X \n{\n    Y *m_y;\n    ...\n};\n\n/* ====== y.h ====== */\n// Forward declaration of X for cyclic dependency\nclass X;\n\nclass Y \n{\n    X *m_x;\n    ...\n};\n")))}p.isMDXComponent=!0}}]);